<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LeafSense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-top: 4px solid #22c55e;
        border-radius: 50%;
        width: 28px;
        height: 28px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Smooth floating effect */
      @keyframes floaty {
        0% {
          transform: translateY(0px) scale(1) rotate(0deg);
        }
        25% {
          transform: translateY(-12px) scale(1.01) rotate(-0.3deg);
        }
        50% {
          transform: translateY(0px) scale(1) rotate(0.2deg);
        }
        75% {
          transform: translateY(12px) scale(0.99) rotate(-0.2deg);
        }
        100% {
          transform: translateY(0px) scale(1) rotate(0deg);
        }
      }
      .floaty {
        animation: floaty 8s ease-in-out infinite;
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-emerald-900 via-green-800 to-black min-h-screen flex flex-col items-center justify-center font-sans text-white relative overflow-hidden"
  >
    <!-- Background Blobs -->
    <div
      class="absolute top-10 left-10 w-72 h-72 bg-green-500 rounded-full blur-3xl opacity-20 animate-pulse"
    ></div>
    <div
      class="absolute bottom-10 right-10 w-80 h-80 bg-emerald-400 rounded-full blur-3xl opacity-20 animate-pulse"
    ></div>

    <!-- Floating Panel -->
    <div
      class="w-full max-w-2xl p-8 rounded-3xl bg-white/20 backdrop-blur-3xl shadow-[0_8px_40px_rgba(0,0,0,0.4)] border border-white/30 relative z-10 text-gray-100 floaty"
    >
      <!-- Header -->
      <div class="text-center mb-8">
        <h1
          class="text-4xl font-extrabold text-white tracking-tight drop-shadow-lg"
        >
          üå± LeafSense
        </h1>
        <p class="text-gray-200 mt-2 text-lg">
          Upload your plant leaf image and let AI detect possible diseases
        </p>
      </div>

      <!-- Upload Box -->
      <div class="space-y-6">
        <div class="flex items-center justify-center w-full" id="dropContainer">
          <div
            id="dropZone"
            class="flex flex-col items-center justify-center w-full h-44 border-2 border-dashed border-white/40 rounded-2xl cursor-pointer bg-white/10 hover:bg-white/20 transition-all duration-300"
          >
            <input
              id="imageInput"
              type="file"
              accept="image/png,image/jpeg,image/jpg"
              class="hidden"
              onchange="previewImage(this.files)"
            />
            <div
              class="flex flex-col items-center justify-center text-center pointer-events-none"
            >
              <svg
                class="w-12 h-12 text-gray-200"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                />
              </svg>
              <p class="text-base font-medium text-gray-100 mt-2">
                Drag & Drop or Click to Upload
              </p>
              <p class="text-xs text-gray-300">PNG, JPG, JPEG (max 5MB)</p>
            </div>
          </div>
        </div>

        <!-- Preview -->
        <div id="previewContainer" class="hidden">
          <img
            id="preview"
            class="w-full h-56 object-contain rounded-xl shadow-lg border border-gray-400/50 bg-white/10 p-2"
          />
          <button
            onclick="removeImage()"
            class="mt-4 w-full bg-gradient-to-r from-red-500 to-pink-600 text-white py-3 rounded-xl font-semibold shadow-md hover:opacity-90 transition-all"
          >
            ‚úñ Remove Image
          </button>
        </div>

        <!-- Predict Button -->
        <button
          onclick="predictImage()"
          class="w-full bg-gradient-to-r from-green-500 via-emerald-600 to-green-700 text-white py-4 rounded-xl font-bold tracking-wide shadow-lg hover:scale-[1.02] transition-all flex items-center justify-center space-x-3 disabled:from-gray-400 disabled:to-gray-500"
          id="predictButton"
          disabled
        >
          <span>üîç Predict Disease</span>
          <span id="loadingSpinner" class="spinner hidden"></span>
        </button>

        <!-- Result -->
        <div id="result" class="mt-6 text-center text-xl font-semibold"></div>
      </div>
    </div>

    <script>
      const dropZone = document.getElementById("dropZone");
      const fileInput = document.getElementById("imageInput");
      const dropContainer = document.getElementById("dropContainer");
      const previewContainer = document.getElementById("previewContainer");
      const preview = document.getElementById("preview");
      const predictButton = document.getElementById("predictButton");

      dropZone.addEventListener("click", () => fileInput.click());

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("bg-white/20", "border-green-400");
      });

      dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("bg-white/20", "border-green-400");
      });

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("bg-white/20", "border-green-400");
        if (e.dataTransfer.files.length > 0) {
          fileInput.files = e.dataTransfer.files;
          previewImage(e.dataTransfer.files);
        }
      });

      function previewImage(files) {
        if (files && files[0]) {
          const file = files[0];
          preview.src = URL.createObjectURL(file);
          dropContainer.classList.add("hidden");
          previewContainer.classList.remove("hidden");
          predictButton.disabled = false;
        }
      }

      function removeImage() {
        fileInput.value = "";
        preview.src = "";
        previewContainer.classList.add("hidden");
        dropContainer.classList.remove("hidden");
        predictButton.disabled = true;
        document.getElementById("result").innerHTML = "";
      }

      function predictImage() {
        const resultDiv = document.getElementById("result");
        const loadingSpinner = document.getElementById("loadingSpinner");

        if (!fileInput.files[0]) {
          resultDiv.innerHTML =
            '<p class="text-red-400">‚ö† Please select an image.</p>';
          return;
        }

        resultDiv.innerHTML = "";
        predictButton.disabled = true;
        loadingSpinner.classList.remove("hidden");

        const formData = new FormData();
        formData.append("image", fileInput.files[0]);

        fetch("/predict", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            loadingSpinner.classList.add("hidden");
            predictButton.disabled = false;
            if (data.error) {
              resultDiv.innerHTML = `<p class="text-red-400">‚ùå Error: ${data.error}</p>`;
            } else {
              resultDiv.innerHTML = `<p class="text-green-300">‚úÖ ${data.message}</p>`;
            }
          })
          .catch((error) => {
            loadingSpinner.classList.add("hidden");
            predictButton.disabled = false;
            resultDiv.innerHTML = `<p class="text-red-400">‚ùå Error: ${error.message}</p>`;
          });
      }
    </script>
  </body>
</html>
